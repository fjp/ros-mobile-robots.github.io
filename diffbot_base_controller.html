
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2, mkdocs-material-7.1.7">
    
    
      
        <title>Diffbot base controller - DiffBot Differential Drive Mobile Robot</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.ca7ac06f.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.f1a3b89f.min.css">
        
      
    
    
    
    <script src="./js/jquery-3.5.1.min.js"></script>
    <script src="./js/jquery.fitvids.js"></script>
    <!-- Arithmatex -->
    <script src="./js/config.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- UML diagrams using Mermaid -->
    <script src="https://unpkg.com/mermaid@8.8.0/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: true, securityLevel: "loose" });
    </script>
    <!-- Adsense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2214309606626131"
     crossorigin="anonymous"></script>
    <!-- Cookie consent -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css" />
    <!-- katex minified versions -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/katex.min.css" integrity="sha384-Cqd8ihRLum0CCg8rz0hYKPoLZ3uw+gES2rXQXycqnL5pgVQIflxAUDS7ZSjITLb5" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/katex.min.js" integrity="sha384-1Or6BdeNQb0ezrmtGeqQHFpppNd7a/gw29xeiSikBbsb44xu3uAo8c7FwbF5jhbd" crossorigin="anonymous"></script>

    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      
        
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-117971961-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <script>function __prefix(e){return new URL(".",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
      <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#diffbot-base-controller-package" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="DiffBot Differential Drive Mobile Robot" class="md-header__button md-logo" aria-label="DiffBot Differential Drive Mobile Robot" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DiffBot Differential Drive Mobile Robot
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Diffbot base controller
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 10a2 2 0 0 1 2 2 2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2m10-3a5 5 0 0 1 5 5 5 5 0 0 1-5 5H7a5 5 0 0 1-5-5 5 5 0 0 1 5-5h10M7 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3h10a3 3 0 0 0 3-3 3 3 0 0 0-3-3H7z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/ros-mobile-robots/diffbot/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="index.html" class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="components.html" class="md-tabs__link">
      Components
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="theory/index.html" class="md-tabs__link">
        Robotics Theory
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="theory/motion-and-odometry.html" class="md-tabs__link">
        Hardware and Theory
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="rpi-setup.html" class="md-tabs__link">
        Processing Units
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="packages.html" class="md-tabs__link">
        Packages
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="DiffBot Differential Drive Mobile Robot" class="md-nav__button md-logo" aria-label="DiffBot Differential Drive Mobile Robot" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    DiffBot Differential Drive Mobile Robot
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/ros-mobile-robots/diffbot/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="components.html" class="md-nav__link">
        Components
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      <label class="md-nav__link" for="__nav_3">
        Robotics Theory
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Robotics Theory" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Robotics Theory
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="theory/index.html" class="md-nav__link">
        Theory behind Robotics
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" >
      
      <label class="md-nav__link" for="__nav_3_2">
        Modeling and Control
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Modeling and Control" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Modeling and Control
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="theory/modeling-control/control-systems-introduction.html" class="md-nav__link">
        Introduction to Control Systems
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="theory/modeling-control/robot-representations.html" class="md-nav__link">
        Representations and models
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="theory/modeling-control/modeling-differential-drive-robot.html" class="md-nav__link">
        Modeling a Differential Drive Robot
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="theory/modeling-control/odometry.html" class="md-nav__link">
        Odometry
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="theory/robot-vision/overview.md" class="md-nav__link">
        Robot Vision
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="theory/object-detection/overview.md" class="md-nav__link">
        Object Detection
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="theory/estimatione-localization/overview.md" class="md-nav__link">
        State Estimation and Localization
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="theory/planning1/overview.md" class="md-nav__link">
        Planning I
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="theory/planning2/overview.md" class="md-nav__link">
        Planning II
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="theory/reinforcement-learning/overview.md" class="md-nav__link">
        Learning by Reinforcement
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="theory/imitation-learning/overview.md" class="md-nav__link">
        Learning by Imitation
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      <label class="md-nav__link" for="__nav_4">
        Hardware and Theory
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Hardware and Theory" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Hardware and Theory
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="theory/motion-and-odometry.html" class="md-nav__link">
        Motion and Odometry
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="power-supply.html" class="md-nav__link">
        Power Supply
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="laser-range-scanner.html" class="md-nav__link">
        Laser Range Scanner
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      <label class="md-nav__link" for="__nav_5">
        Processing Units
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Processing Units" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Processing Units
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="rpi-setup.html" class="md-nav__link">
        Raspberry Pi Setup
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="jetson-nano-setup.html" class="md-nav__link">
        Jetson Nano Setup
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="git-setup.html" class="md-nav__link">
        Git Setup
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="ros-setup.html" class="md-nav__link">
        ROS Setup
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="teensy-mcu.html" class="md-nav__link">
        Teensy MCU
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="hardware-interfaces.html" class="md-nav__link">
        Hardware Interfaces
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="ros-network-setup.html" class="md-nav__link">
        ROS Network Setup
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      <label class="md-nav__link" for="__nav_6">
        Packages
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Packages" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Packages
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="packages.html" class="md-nav__link">
        Packages
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="diffbot_robot.html" class="md-nav__link">
        Robot Package
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="robot-description.html" class="md-nav__link">
        Robot Description
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="diffbot_gazebo.html" class="md-nav__link">
        Simulation
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="diffbot_control.html" class="md-nav__link">
        Control
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="diffbot_base.html" class="md-nav__link">
        Base Hardware Interface
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="diffbot_msgs.html" class="md-nav__link">
        Messages
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="grove_motor_driver.html" class="md-nav__link">
        Motor Driver
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="DG01D-E-motor-with-encoder.html" class="md-nav__link">
        Motor and Encoder
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="diffbot_navigation.html" class="md-nav__link">
        Navigation
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="diffbot_slam.html" class="md-nav__link">
        SLAM
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="diffbot_mbf.html" class="md-nav__link">
        Move Base Flex
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="diffbot_bringup.html" class="md-nav__link">
        Hardware Bringup
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#diffbot-base-controller-package" class="md-nav__link">
    DiffBot Base Controller Package
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-messages" class="md-nav__link">
    Custom Messages
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pid-controller" class="md-nav__link">
    PID Controller
  </a>
  
    <nav class="md-nav" aria-label="PID Controller">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#launch-file" class="md-nav__link">
    Launch File
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-requirements" class="md-nav__link">
    Additional Requirements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simulation" class="md-nav__link">
    Simulation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              



                
                  <a href="https://github.com/ros-mobile-robots/ros-mobile-robots.github.io/tree/main/docs/diffbot_base_controller.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  <h1>Diffbot base controller</h1>
                
                <h2 id="diffbot-base-controller-package">DiffBot Base Controller Package</h2>
<p>This package contains the low level code for a microcontroller such as the Teensy 3.2 or 4.0.
It communicates mostly with the the diffbot's implementation of 
<code>hardware_interface::RobotHW</code> in the <a href="diffbot_base.html"><code>diffbot_base</code></a>.</p>
<p>The subscriber, publisher and topics relations are as follows:</p>
<table>
<thead>
<tr>
<th align="center">Topic</th>
<th align="center"><code>hardware_interface::RobotHW</code></th>
<th align="center"><code>base_controller</code></th>
<th align="center">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>wheel_command_velocities</code></td>
<td align="center">publish</td>
<td align="center">subscribe</td>
<td align="center">target angular wheel joint velocities computed by the <code>diff_drive_controller</code>.</td>
</tr>
<tr>
<td align="center"><code>encoder_ticks</code></td>
<td align="center">subscribe</td>
<td align="center">publish</td>
<td align="center">tick count read from the encoders, which are connected to the microcontroller.</td>
</tr>
<tr>
<td align="center"><code>reset</code></td>
<td align="center">publish</td>
<td align="center">subscribe</td>
<td align="center">Topic to publish and empty message to reset the encoder ticks to zero.</td>
</tr>
</tbody>
</table>
<ul>
<li>No dynamic reconfigure on rosserial supported. This is why we use custom messages for the low level PID controller.</li>
</ul>
<h2 id="custom-messages">Custom Messages</h2>
<ul>
<li>Encoders</li>
<li>EncodersStamped</li>
<li>PID</li>
<li>WheelsCmd: Command message that contains the target angular wheel velocities <span class="arithmatex">\(\dot{\phi}\)</span>.</li>
<li>WheelsCmdStamped: Adds a <code>std_msgs/Header</code> to the <code>WheelsCmd</code> message. </li>
<li>AngularVelocities</li>
<li>AngularVelocitiesStamped</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>rosserial is based on C and only uses raw pointers as arrays and
those don't have any intrinsic <code>size</code> property that could be queried.
When working with messages that contain arrays of undefined size and rosserial,
it is required to reserve the apropriate amount of memory using <a href="https://en.cppreference.com/w/c/memory/malloc"><code>malloc</code></a>.
Additionally the *_length member of type int that is part of the generated message has to be set accordingly.</p>
</div>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<p>Also be aware that the arrays in the messages are not defined as vector objects. Thus you have to predefine the array and then pass it as pointer to the message. To determine the end of the array each one has an auto-generated integer companion with the same name and the suffix _length (see also <a href="http://wiki.ros.org/rosserial/Overview/Limitations#Arrays">rosserial/Overview/Limitations</a>). [^messages_overview] </p>
</div>
<h2 id="parameters">Parameters</h2>
<p>The <code>base_controller</code> relies on the following parameters stored on the paramter server,
which are configured in the <code>config/base.yaml</code> and also party in the <code>diffbot_control/config/diffbot_control.yaml</code>:</p>
<table>
<thead>
<tr>
<th align="center">Parameter</th>
<th align="center">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">wheel_radius</td>
<td align="center">Radius of both wheel (assumed to be the same)</td>
</tr>
<tr>
<td align="center">wheel_separation</td>
<td align="center">Baseline distance between the two wheels</td>
</tr>
<tr>
<td align="center">encoder_resolution</td>
<td align="center">Total number of tick counts per one full revolution of a wheel</td>
</tr>
<tr>
<td align="center">gain</td>
<td align="center">Gain parameter of the gain trim model[^d]</td>
</tr>
</tbody>
</table>
<h2 id="pid-controller">PID Controller</h2>
<p :=":" class="notice">Note the two PID controllers inside the hardware interface, where each PID is passed the error between velocity measured by the encoders 
and the target velocity computed by the <code>diff_drive_controller</code> for a specific wheel joint. 
The <code>diff_drive_controller</code> doesn't have a PID controller integrated, and doesn't take care if the wheels of the robot are actually turning.
As mentioned above, ROS Control expects that the commands sent by the controller are actually implemented on the real robot hardware and that the
joint states are always up to date. This means that the <code>diff_drive_controller</code> just uses the <code>twist_msg</code> on the <code>cmd_vel</code> topic for example from the <code>rqt_robot_steering</code> and converts it to a velocity command for the motors. It doesn't take the actual velocity of the motors into account. 
See <a href="https://github.com/ros-controls/ros_controllers/blob/698f85b2c3467dfcc3ca5743d68deba03f3fcff2/diff_drive_controller/src/diff_drive_controller.cpp#L460">the code of <code>diff_drive_controller</code></a> where the <code>joint_command_velocity</code> is calculated. </p>
<p>This is why a PID controller is needed to avoid situations like the following where the robot moves not straigth although it is commanded to do so:</p>
<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/chUPeWXtim4" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<p>The PID used here inherits from the ROS Control <a href="http://wiki.ros.org/control_toolbox"><code>control_toolbox::Pid</code></a> that provides Dynamic Reconfigure out of the box to tune the proportional, integral and derivative gains. The behaviour when using only the P, I and D gains is that the output can overshoot and even change between positive and negative motor percent values because of a P gain that is too high. To avoid this, a feed forward gain can help to reach the setpoint faster.
To add this feed forward gain to the dynamic reconfigure parameters it is necessary to add a new parameter configuration file in this package inside a <code>cfg</code> folder. </p>
<p>For more details on ROS dynamic reconfigure see <a href="http://wiki.ros.org/dynamic_reconfigure/Tutorials">the official tutorials</a>.</p>
<p>With the use of the PID controller the robot is able to drive straight:</p>
<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/fdn5Mu0Qhl8" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<p>In case of using inexpensive motors like the <a href="https://www.sparkfun.com/products/16413">DG01D-E</a> of DiffBot,
you have to take inaccurate driving behaviour into account. The straight driving behaviour can be improved
with motors that start spinning at the same voltage levels. To find suitable motors do a voltage sweep test by slightly increasing the voltage and
note the voltage level where each motor starts to rotate. Such a test was done on DiffBot's motors. </p>
<p>Using six <a href="https://www.sparkfun.com/products/16413">DG01D-E</a> motors the following values were recorded (sorted by increasing voltage):</p>
<table>
<thead>
<tr>
<th align="center">Motor</th>
<th align="center">Voltage (V)</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">01</td>
<td align="center">2.5</td>
</tr>
<tr>
<td align="center">02</td>
<td align="center">2.8 - 3.0</td>
</tr>
<tr>
<td align="center">03</td>
<td align="center">3.1</td>
</tr>
<tr>
<td align="center">04</td>
<td align="center">3.2</td>
</tr>
<tr>
<td align="center">05</td>
<td align="center">3.2</td>
</tr>
<tr>
<td align="center">06</td>
<td align="center">3.3</td>
</tr>
</tbody>
</table>
<p class="notice">In the videos above, motors numbered 01 and 03 were used coincidencely and I wasn't aware of the remarkable differences in voltage levels.
Using the motors 04 and 05 improved the driving behaviour significantly. </p>
<p>To deal with significant differences in the motors it would also help to tune the two PIDs individually,
which is not shown in the <a href="https://youtu.be/fdn5Mu0Qhl8">video above</a>.</p>
<p class="notice">Make also sure that the motor driver outputs the same voltage level on both channels when the robot is commanded to move straight.
The used Grove i2c motor driver was tested to do this.
Another problem of not driving straight can be weight distribution or the orientation of the caster wheel.</p>
<p>A good test to check the accuracy is to fix two meters of adhesive tape on the floor in a straight line. 
Then, place the robot on one end oriented in the direction to the other end. Now command it to move straight along the line
and stop it when it reaches the end of the tape. Record the lateral displacement from the tape. 
Measuring a value below 10 cm is considered precise for these motors.</p>
<h3 id="launch-file">Launch File</h3>
<p>To run a single controller_manager, the one from the <code>diffbot_base</code> package defined inside <code>difbot_base.cpp</code> use the 
launch file from <a href="https://github.com/fjp/diffbot/blob/master/ros/src/diffbot_base/launch/diffbot.launch"><code>diffbot_base/launch/diffbot.launch</code></a>:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c">&lt;!-- https://github.com/ros-controls/ros_controllers/tree/kinetic-devel/diff_drive_controller/test --&gt;</span>
<span class="nt">&lt;launch&gt;</span>
    <span class="c">&lt;!-- Load DiffBot model --&gt;</span>
    <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;robot_description&quot;</span>
       <span class="na">command=</span><span class="s">&quot;$(find xacro)/xacro &#39;$(find diffbot_description)/urdf/diffbot.xacro&#39;&quot;</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">&quot;diffbot_base&quot;</span> <span class="na">pkg=</span><span class="s">&quot;diffbot_base&quot;</span> <span class="na">type=</span><span class="s">&quot;diffbot_base&quot;</span><span class="nt">/&gt;</span>

    <span class="c">&lt;!-- Load controller config to the parameter server --&gt;</span>
    <span class="nt">&lt;rosparam</span> <span class="na">command=</span><span class="s">&quot;load&quot;</span> 
              <span class="na">file=</span><span class="s">&quot;$(find diffbot_control)/config/diffbot_control.yaml&quot;</span><span class="nt">/&gt;</span>

    <span class="c">&lt;!-- Load base config to the parameter server --&gt;</span>
    <span class="nt">&lt;rosparam</span> <span class="na">command=</span><span class="s">&quot;load&quot;</span> 
              <span class="na">file=</span><span class="s">&quot;$(find diffbot_base)/config/base.yaml&quot;</span><span class="nt">/&gt;</span>

    <span class="c">&lt;!-- Load the controllers --&gt;</span>
    <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">&quot;controller_spawner&quot;</span> <span class="na">pkg=</span><span class="s">&quot;controller_manager&quot;</span> <span class="na">type=</span><span class="s">&quot;spawner&quot;</span> <span class="na">respawn=</span><span class="s">&quot;false&quot;</span>
        <span class="na">output=</span><span class="s">&quot;screen&quot;</span> <span class="na">ns=</span><span class="s">&quot;diffbot&quot;</span> <span class="na">args=</span><span class="s">&quot;joint_state_controller</span>
<span class="s">                                            mobile_base_controller&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/launch&gt;</span>
</code></pre></div>
</td></tr></table>
<p>This will load the DiffBot robot description onto the parameter server which is required for the hardware interface that gets created inside the next
node <code>diffbot_base</code>. It creates the hardware interface and instantiates a new controller manager in the <code>diffbot_base.cpp</code>.
Finally the <code>spawner</code> from the <code>controller_manager</code> package is used to initialize and start the controllers defined in the <code>diffbot_control/config/diffbot_control.yaml</code>. This step of the launch file is required to get the controllers initialized and started.
Another way would be to use <code>controller_manager::ControllerManager::loadControllers()</code> inside the <code>diffbot_base.cpp</code>.</p>
<p>Additionally the launch file loads additional parameters, stored in the <code>diffbot_base/config/base.yaml</code> on the parameter server.
These parameters are hardware related and used to tune the driving behaviour:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code># Hardware related parameters
# will be loaded onto the parameter server
# See the diffbot.launch
diffbot:
  encoder_resolution: 542
  gain: 1.0
  trim: 0.0
  motor_constant: 27.0
  pwm_limit: 1.0
</code></pre></div>
</td></tr></table>
<p>After launching this launch file on DiffBot's single board computer (e.g. Raspberry Pi or Jetson Nano) with </p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="go">roslaunch diffbot_base diffbot.launch</span>
</code></pre></div>
</td></tr></table>
<p>the following parameters are stored on the parameter server:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="gp">$</span> rosparam list
<span class="go">/diffbot/hardware_interface/joints</span>
<span class="go">/diffbot/joint_state_controller/extra_joints</span>
<span class="go">/diffbot/joint_state_controller/publish_rate</span>
<span class="go">/diffbot/joint_state_controller/type</span>
<span class="go">/diffbot/mobile_base_controller/base_frame_id</span>
<span class="go">/diffbot/mobile_base_controller/left_wheel</span>
<span class="go">/diffbot/mobile_base_controller/pose_covariance_diagonal</span>
<span class="go">/diffbot/mobile_base_controller/publish_rate</span>
<span class="go">/diffbot/mobile_base_controller/right_wheel</span>
<span class="go">/diffbot/mobile_base_controller/twist_covariance_diagonal</span>
<span class="go">/diffbot/mobile_base_controller/type</span>
<span class="go">/diffbot/mobile_base_controller/wheel_radius</span>
<span class="go">/diffbot/mobile_base_controller/wheel_separation</span>
<span class="go">/robot_description</span>
<span class="go">/rosdistro</span>
<span class="go">/roslaunch/uris/host_tensorbook__46157</span>
<span class="go">/roslaunch/uris/host_ubuntu__33729</span>
<span class="go">/rosversion</span>
<span class="go">/run_id</span>
</code></pre></div>
</td></tr></table>
<h2 id="additional-requirements">Additional Requirements</h2>
<p>Because the hardware interface subscribes to the encoders, that are connected to the Teensy MCU, and publishes to the motors via the motr driver node,
another launch will be required to run these additional nodes. See the <code>diffbot_bringup</code> package for this setup.</p>
<h2 id="simulation">Simulation</h2>
<p>To have a simulation showing DiffBot, the second step is to use the <a href="https://github.com/fjp/diffbot/blob/master/ros/src/diffbot_gazebo/launch/diffbot_base.launch"><code>diffbot_gazebo/launch/diffbot_base.launch</code></a> on the work pc:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="gp">$</span> roslaunch diffbot_gazebo diffbot_base.launch
</code></pre></div>
</td></tr></table>
<p>This will launch the gazebo simulation, which can make use of the running controllers inside the controller manager too:</p>
<figure>
    <a href="https://raw.githubusercontent.com/fjp/diffbot/master/docs/resources/ros_control_gazebo.png"><img src="https://raw.githubusercontent.com/fjp/diffbot/master/docs/resources/ros_control_gazebo.png"></a>
    <figcaption><a href="http://gazebosim.org/tutorials/?tut=ros_control" title="ROS Control with Gazebo">ROS Control with Gazebo</a> Overview.</figcaption>
</figure>

<p>After launching the Gazebo simulation the controllers got uninitialized.
(It is assumed that the <a href="https://github.com/ros-simulation/gazebo_ros_pkgs/tree/kinetic-devel/gazebo_ros_control"><code>gazebo_ros_control</code></a> plugin that gets launched). Because of this the controllers have to be initialized and started again. For this the <a href="https://github.com/fjp/diffbot/blob/master/ros/src/diffbot_base/launch/controllers.launch"><code>diffbot_base/launch/controllers.launch</code></a> should be used.
This launch file is just loading and starting all controllers again. Note that using the <code>spawner</code> from the <code>controller_manager</code> package, like in the <code>diffbot_base/launch/diffbot.launch</code> results in an error. (TODO this needs some more testing).</p>
<h2 id="references">References</h2>
<p>[^d] <a href="https://ethz.ch/content/dam/ethz/special-interest/mavt/dynamic-systems-n-control/idsc-dam/Lectures/amod/Lecture_13/20191104%20-%20ETH%20-%2002%20-%20OdometryCalibration.pdf">ETH Zürich Odometry Calibration: Gain Trim Model</a></p>
<p>[^messages_overview] http://wiki.ros.org/rosserial/Overview/Messages</p>
                
              

              
                


              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" title="Back to top" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
          </a>
        
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": ["navigation.tabs", "navigation.top"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "assets/javascripts/workers/search.b0710199.min.js", "version": null}</script>
    
    
    
      <script src="assets/javascripts/bundle.76f349be.min.js"></script>
      
    
    <script>
        $(document).ready(function(){
            // Target your .container, .wrapper, .post, etc.
            $(".md-main").fitVids();
        });
    </script>
    <!-- cookie consent -->
    <script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script>
    <script>
    window.cookieconsent.initialise({
    "palette": {
        "popup": {
        "background": "#edeff5",
        "text": "#838391"
        },
        "button": {
        "background": "#4b81e8"
        }
    },
    "theme": "classic"
    });
    </script>

  </body>
</html>